<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Claim Server Code</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 40px; }
    button { padding: 10px 20px; font-size: 16px; }
    #codeBox { font-size: 20px; color: green; margin-top: 20px; }
    #claimStatus { font-size: 16px; color: red; margin-top: 10px; }
  </style>
</head>
<body>

  <h2>üéÆ Claim a Server Code</h2>
  <button id="claimBtn">Claim Code</button>
  <div id="codeBox"></div>
  <div id="claimStatus"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
    import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js";

    // ‚úÖ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBDJgEb2uCYOTfACJRr4ni-TPLdocP4pxk",
      authDomain: "data-5f291.firebaseapp.com",
      databaseURL: "https://data-5f291-default-rtdb.firebaseio.com",
      projectId: "data-5f291",
      storageBucket: "data-5f291.appspot.com",
      messagingSenderId: "397689315534",
      appId: "1:397689315534:web:88980e22fd9b4c8456f09f",
      measurementId: "G-2X20MH4M4B"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const codesRef = ref(db, 'serverCodes');
    const PASSWORD = "admin123";

    const initialCodes = [
      "adv1",
      "adv2",
      "SMP-THREE-6123",
      "SMP-FOUR-4455",
      "SMP-FIVE-1122"
    ];

    // Auto-add server codes on first load
    async function autoAddCodes() {
      const snapshot = await get(codesRef);
      if (!snapshot.exists()) {
        const updates = {};
        initialCodes.forEach((code, index) => {
          updates[`code${index + 1}`] = {
            code: code,
            claimed: false
          };
        });
        await set(codesRef, updates);
        console.log("‚úÖ Server codes added");
      } else {
        console.log("‚ÑπÔ∏è Server codes already exist");
      }
    }

    // Run once on load
    autoAddCodes();

    // Claim server code
    async function claimServerCode() {
      const inputPass = prompt("Enter the password:");
      if (inputPass !== PASSWORD) {
        alert("‚ùå Incorrect password!");
        return;
      }

      const snapshot = await get(codesRef);
      if (snapshot.exists()) {
        const codes = snapshot.val();
        let found = false;

        for (const [key, value] of Object.entries(codes)) {
          if (!value.claimed) {
            await set(ref(db, `serverCodes/${key}`), {
              code: value.code,
              claimed: true,
              timestamp: Date.now()
            });

            document.getElementById("codeBox").innerText = "‚úÖ Your Server Code: " + value.code;
            document.getElementById("claimStatus").innerText = "";
            found = true;
            break;
          }
        }

        if (!found) {
          document.getElementById("codeBox").innerText = "";
          document.getElementById("claimStatus").innerText = "‚ùå All codes have been claimed.";
        }
      } else {
        document.getElementById("codeBox").innerText = "";
        document.getElementById("claimStatus").innerText = "‚ö†Ô∏è No codes available.";
      }
    }

    // ‚úÖ Attach button click handler after load
    document.getElementById("claimBtn").addEventListener("click", claimServerCode);
  </script>

</body>
</html>
